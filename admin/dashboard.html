<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Store - Admin Dashboard</title>
    <link href="../src/output.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        /* Custom styles for tabs to blend with Tailwind */
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Full rounded */
            font-weight: 500; /* Medium font weight */
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid transparent; /* Add a subtle border */
        }

        .tab-button:hover {
            background-color: rgba(0, 0, 0, 0.05); /* Subtle hover effect */
        }

        .tab-button.active {
            background-color: #000; /* Black background for active tab */
            color: #fff; /* White text for active tab */
            border-color: #000; /* Black border for active tab */
        }

        /* Loading Spinner Styles */
        .loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            z-index: 100; /* Ensure it's on top */
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7); /* Semi-transparent white overlay */
            z-index: 99; /* Below the spinner */
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="loadingSpinner" class="loading-spinner hidden"></div>
    <div id="loadingOverlay" class="loading-overlay hidden"></div>

    <div class="flex h-screen">
        <div class="w-64 bg-black text-white p-6 hidden md:block">
            <div class="mb-8">
                <a href="../index.html">
                    <span class="text-xl font-semibold">Urban Store</span>
                </a>
            </div>
            <nav>
                <ul class="space-y-4">
                    <li class="pb-2 border-b border-gray-700">
                        <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300" id="dashboardNav">
                            <i class="fas fa-tachometer-alt w-5"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="pb-2 border-b border-gray-700">
                        <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300" id="productsNav">
                            <i class="fas fa-boxes w-5"></i>
                            <span>Products</span>
                        </a>
                    </li>
                    <li class="pb-2 border-b border-gray-700">
                        <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300" id="ordersNav">
                            <i class="fas fa-shopping-cart w-5"></i>
                            <span>Orders</span>
                        </a>
                    </li>
                     <li class="pb-2 border-b border-gray-700">
                        <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300" id="reportsNav">
                            <i class="fas fa-chart-line w-5"></i>
                            <span>Reports</span>
                        </a>
                    </li>
                    <li class="pb-2 border-b border-gray-700">
                        <a href="../index.html" class="flex items-center gap-3 py-2 text-white hover:text-gray-300">
                            <i class="fas fa-store w-5"></i>
                            <span>View Store</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white border-b border-gray-300 p-4 flex items-center justify-between">
                <div class="flex items-center md:hidden">
                    <button id="sidebarToggle" class="p-2">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <div class="flex-1 md:text-center">
                    <h1 class="text-xl font-semibold">Admin Dashboard</h1>
                </div>
                <div>
                    <button class="p-2">
                        <i class="fas fa-user-circle text-xl"></i>
                    </button>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-6">
                <div id="dashboardSection" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white rounded-2xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-gray-500">Total Products</h3>
                                <span class="text-blue-500 bg-blue-100 p-2 rounded-full">
                                    <i class="fas fa-boxes"></i>
                                </span>
                            </div>
                            <p class="text-2xl font-bold" id="totalProducts">0</p>
                        </div>
                        <div class="bg-white rounded-2xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-gray-500">Total Orders</h3>
                                <span class="text-green-500 bg-green-100 p-2 rounded-full">
                                    <i class="fas fa-shopping-cart"></i>
                                </span>
                            </div>
                            <p class="text-2xl font-bold" id="totalOrders">0</p>
                        </div>
                        <div class="bg-white rounded-2xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-gray-500">Revenue</h3>
                                <span class="text-purple-500 bg-purple-100 p-2 rounded-full">
                                    <i class="fas fa-dollar-sign"></i>
                                </span>
                            </div>
                            <p class="text-2xl font-bold" id="totalRevenue">$0.00</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h2 class="text-lg font-medium mb-4">Recent Orders</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="recentOrdersTable">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="5">No recent orders</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="productsSection" class="space-y-6 hidden">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold">Products</h2>
                        <button id="addProductBtn" class="bg-black text-white px-4 py-2 rounded-full hover:opacity-90 transition-opacity flex items-center gap-2">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <div class="mb-4 flex justify-between items-center">
                            <div class="relative">
                                <input type="text" id="productSearch" placeholder="Search products..." class="pl-10 pr-4 py-2 border rounded-full w-64">
                                <i class="fas fa-search absolute left-4 top-3 text-gray-400"></i>
                            </div>
                            <div>
                                <select id="categoryFilter" class="border rounded-full px-4 py-2">
                                    <option value="">All Categories</option>
                                    <option value="Gadgets">Gadgets</option>
                                    <option value="Audio">Audio</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="productsTable">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="6">No products found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="ordersSection" class="space-y-6 hidden">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold">Orders</h2>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <div class="mb-4 flex justify-between items-center">
                            <div class="relative">
                                <input type="text" id="orderSearch" placeholder="Search orders..." class="pl-10 pr-4 py-2 border rounded-full w-64">
                                <i class="fas fa-search absolute left-4 top-3 text-gray-400"></i>
                            </div>
                            <div>
                                <select id="statusFilter" class="border rounded-full px-4 py-2">
                                    <option value="">All Statuses</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Processing">Processing</option>
                                    <option value="Shipped">Shipped</option>
                                    <option value="Delivered">Delivered</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="ordersTable">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="6">No orders found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="reportsSection" class="space-y-6 hidden">
                    <h2 class="text-xl font-semibold mb-4">Sales Reports</h2>

                    <div class="flex space-x-4 mb-6">
                        <button class="tab-button active" data-tab="daily">Daily</button>
                        <button class="tab-button" data-tab="weekly">Weekly</button>
                        <button class="tab-button" data-tab="monthly">Monthly</button>
                    </div>

                    <div id="reportContent">
                        <div id="dailyReportContent" class="bg-white rounded-2xl p-6 shadow-sm space-y-4">
                             <h3 class="text-lg font-medium">Daily Sales</h3>
                            <p class="text-2xl font-bold" id="dailySalesTotal">$0.00</p>
                            <div class="mt-4 text-sm text-gray-600">
                                <p>Pending: <span id="dailyPendingOrders">0</span></p>
                                <p>Processing: <span id="dailyProcessingOrders">0</span></p>
                                <p>Shipped: <span id="dailyShippedOrders">0</span></p>
                                <p>Delivered: <span id="dailyDeliveredOrders">0</span></p>
                                <p>Cancelled: <span id="dailyCancelledOrders">0</span></p>
                            </div>
                        </div>

                        <div id="weeklyReportContent" class="bg-white rounded-2xl p-6 shadow-sm space-y-4 hidden">
                            <h3 class="text-lg font-medium">Weekly Sales</h3>
                             <p class="text-2xl font-bold" id="weeklySalesTotal">$0.00</p>
                            <div class="mt-4 text-sm text-gray-600">
                                <p>Pending: <span id="weeklyPendingOrders">0</span></p>
                                <p>Processing: <span id="weeklyProcessingOrders">0</span></p>
                                <p>Shipped: <span id="weeklyShippedOrders">0</span></p>
                                <p>Delivered: <span id="weeklyDeliveredOrders">0</span></p>
                                <p>Cancelled: <span id="weeklyCancelledOrders">0</span></p>
                            </div>
                        </div>

                        <div id="monthlyReportContent" class="bg-white rounded-2xl p-6 shadow-sm space-y-4 hidden">
                            <h3 class="text-lg font-medium">Monthly Sales</h3>
                             <p class="text-2xl font-bold" id="monthlySalesTotal">$0.00</p>
                            <div class="mt-4 text-sm text-gray-600">
                                <p>Pending: <span id="monthlyPendingOrders">0</span></p>
                                <p>Processing: <span id="monthlyProcessingOrders">0</span></p>
                                <p>Shipped: <span id="monthlyShippedOrders">0</span></p>
                                <p>Delivered: <span id="monthlyDeliveredOrders">0</span></p>
                                <p>Cancelled: <span id="monthlyCancelledOrders">0</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                </main>
        </div>
    </div>

    <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Add New Product</h2>
                <button id="closeAddProductModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addProductForm">
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="productName" class="block text-sm font-medium text-gray-700 mb-1">Product Name</label>
                            <input type="text" id="productName" name="name" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="productCategory" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="productCategory" name="category" class="w-full px-4 py-2 border rounded-lg" required>
                                <option value="">Select Category</option>
                                <option value="Gadgets">Gadgets</option>
                                <option value="Audio">Audio</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="productPrice" class="block text-sm font-medium text-gray-700 mb-1">Price ($)</label>
                            <input type="number" id="productPrice" name="price" min="0" step="0.01" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="productOriginalPrice" class="block text-sm font-medium text-gray-700 mb-1">Original Price ($) (Optional)</label>
                            <input type="number" id="productOriginalPrice" name="originalPrice" min="0" step="0.01" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label for="productImage" class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                        <input type="url" id="productImage" name="image" class="w-full px-4 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label for="productDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="productDescription" name="description" rows="3" class="w-full px-4 py-2 border rounded-lg" required></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="productRating" class="block text-sm font-medium text-gray-700 mb-1">Rating (1-5)</label>
                            <input type="number" id="productRating" name="rating" min="1" max="5" step="0.1" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="productReviews" class="block text-sm font-medium text-gray-700 mb-1">Reviews Count</label>
                            <input type="number" id="productReviews" name="reviews" min="0" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="productDiscount" class="block text-sm font-medium text-gray-700 mb-1">Discount % (Optional)</label>
                            <input type="number" id="productDiscount" name="discount" min="0" max="100" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label class="inline-flex items-center">
                            <input type="checkbox" id="productInStock" name="inStock" class="rounded">
                            <span class="ml-2">In Stock</span>
                        </label>
                    </div>
                </div>
                <div class="mt-6">
                    <button type="submit" class="w-full bg-black text-white py-3 rounded-full font-medium hover:opacity-90 transition-opacity">
                        Add Product
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="viewOrderModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Order Details</h2>
                <button id="closeViewOrderModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="orderDetailsContent">
                </div>
            <div class="mt-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="orderStatus" class="block text-sm font-medium text-gray-700 mb-1">Update Status</label>
                        <select id="orderStatus" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Pending">Pending</option>
                            <option value="Processing">Processing</option>
                            <option value="Shipped">Shipped</option>
                            <option value="Delivered">Delivered</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button id="updateOrderStatus" class="w-full bg-black text-white py-2 rounded-full font-medium hover:opacity-90 transition-opacity">
                            Update Status
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="editProductModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Edit Product</h2>
                <button id="closeEditProductModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editProductForm">
                <input type="hidden" id="editProductId">
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="editProductName" class="block text-sm font-medium text-gray-700 mb-1">Product Name</label>
                            <input type="text" id="editProductName" name="name" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="editProductCategory" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="editProductCategory" name="category" class="w-full px-4 py-2 border rounded-lg" required>
                                <option value="">Select Category</option>
                                <option value="Gadgets">Gadgets</option>
                                <option value="Audio">Audio</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="editProductPrice" class="block text-sm font-medium text-gray-700 mb-1">Price ($)</label>
                            <input type="number" id="editProductPrice" name="price" min="0" step="0.01" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="editProductOriginalPrice" class="block text-sm font-medium text-gray-700 mb-1">Original Price ($) (Optional)</label>
                            <input type="number" id="editProductOriginalPrice" name="originalPrice" min="0" step="0.01" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label for="editProductImage" class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                        <input type="url" id="editProductImage" name="image" class="w-full px-4 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label for="editProductDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="editProductDescription" name="description" rows="3" class="w-full px-4 py-2 border rounded-lg" required></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="editProductRating" class="block text-sm font-medium text-gray-700 mb-1">Rating (1-5)</label>
                            <input type="number" id="editProductRating" name="rating" min="1" max="5" step="0.1" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="editProductReviews" class="block text-sm font-medium text-gray-700 mb-1">Reviews Count</label>
                            <input type="number" id="editProductReviews" name="reviews" min="0" class="w-full px-4 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label for="editProductDiscount" class="block text-sm font-medium text-gray-700 mb-1">Discount % (Optional)</label>
                            <input type="number" id="editProductDiscount" name="discount" min="0" max="100" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label class="inline-flex items-center">
                            <input type="checkbox" id="editProductInStock" name="inStock" class="rounded">
                            <span class="ml-2">In Stock</span>
                        </label>
                    </div>
                </div>
                <div class="mt-6">
                    <button type="submit" class="w-full bg-black text-white py-3 rounded-full font-medium hover:opacity-90 transition-opacity">
                        Update Product
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md">
            <div class="text-center">
                <i class="fas fa-exclamation-triangle text-red-500 text-5xl mb-4"></i>
                <h3 class="text-xl font-medium mb-2">Confirm Deletion</h3>
                <p class="text-gray-500 mb-6">Are you sure you want to delete this product? This action cannot be undone.</p>
                <input type="hidden" id="deleteProductId">
                <div class="flex justify-center gap-4">
                    <button id="cancelDelete" class="px-6 py-2 border border-gray-300 rounded-full hover:bg-gray-100 transition-colors">
                        Cancel
                    </button>
                    <button id="confirmDelete" class="px-6 py-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>
    <div id="mobileSidebar" class="fixed inset-y-0 left-0 w-64 bg-black text-white p-6 z-50 transform -translate-x-full transition-transform md:hidden">
        <div class="mb-8">
            <a href="../index.html">
                <span class="text-xl font-semibold">Urban Store</span>
            </a>
        </div>
        <nav>
            <ul class="space-y-4">
                <li class="pb-2 border-b border-gray-700">
                    <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300 mobile-nav" data-target="dashboardSection">
                        <i class="fas fa-tachometer-alt w-5"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="pb-2 border-b border-gray-700">
                    <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300 mobile-nav" data-target="productsSection">
                        <i class="fas fa-boxes w-5"></i>
                        <span>Products</span>
                    </a>
                </li>
                <li class="pb-2 border-b border-gray-700">
                    <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300 mobile-nav" data-target="ordersSection">
                        <i class="fas fa-shopping-cart w-5"></i>
                        <span>Orders</span>
                    </a>
                </li>
                 <li class="pb-2 border-b border-gray-700">
                    <a href="#" class="flex items-center gap-3 py-2 text-white hover:text-gray-300 mobile-nav" data-target="reportsSection">
                        <i class="fas fa-chart-line w-5"></i>
                        <span>Reports</span>
                    </a>
                </li>
                <li class="pb-2 border-b border-gray-700">
                    <a href="../index.html" class="flex items-center gap-3 py-2 text-white hover:text-gray-300">
                        <i class="fas fa-store w-5"></i>
                        <span>View Store</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <script>
       document.addEventListener('DOMContentLoaded', function() {
    // API Endpoint
    const PANTRY_API_URL = 'https://getpantry.cloud/apiv1/pantry/ce73e3ad-57b8-4a32-b825-dc652e3a849c/basket/products';
    const ORDERS_API_URL = 'https://getpantry.cloud/apiv1/pantry/ce73e3ad-57b8-4a32-b825-dc652e3a849c/basket/orders';

    // State management
    let products = [];
    let orders = [];

    // Get loading spinner and overlay elements
    const loadingSpinner = document.getElementById('loadingSpinner');
    const loadingOverlay = document.getElementById('loadingOverlay');

    function showLoading() {
        loadingSpinner.classList.remove('hidden');
        loadingOverlay.classList.remove('hidden');
    }

    // Function to hide loading spinner
    function hideLoading() {
        loadingSpinner.classList.add('hidden');
        loadingOverlay.classList.add('hidden');
    }


    // Toast notification helper function
    function showToast(message, type = 'success') {
        const backgroundColor = type === 'success' ? '#4CAF50' :
                                type === 'error' ? '#F44336' :
                                type === 'warning' ? '#FF9800' : '#2196F3';

        Toastify({
            text: message,
            duration: 3000,
            close: true,
            gravity: "top",
            position: "right",
            backgroundColor: backgroundColor,
            stopOnFocus: true
        }).showToast();
    }

    // Navigation
    const dashboardSection = document.getElementById('dashboardSection');
    const productsSection = document.getElementById('productsSection');
    const ordersSection = document.getElementById('ordersSection');
    const reportsSection = document.getElementById('reportsSection');

    document.getElementById('dashboardNav').addEventListener('click', function(e) {
        e.preventDefault();
        showSection(dashboardSection);
    });

    document.getElementById('productsNav').addEventListener('click', function(e) {
        e.preventDefault();
        showSection(productsSection);
    });

    document.getElementById('ordersNav').addEventListener('click', function(e) {
        e.preventDefault();
        showSection(ordersSection);
    });

    document.getElementById('reportsNav').addEventListener('click', function(e) {
        e.preventDefault();
        showSection(reportsSection);
        generateReports(); // Generate reports when the section is shown
    });


    // Mobile Navigation
    document.querySelectorAll('.mobile-nav').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('data-target');
            const targetSection = document.getElementById(targetId);
            showSection(targetSection);
            toggleMobileSidebar();

            // Generate reports if the reports section is targeted
            if (targetId === 'reportsSection') {
                generateReports();
            }
        });
    });

    function showSection(section) {
        dashboardSection.classList.add('hidden');
        productsSection.classList.add('hidden');
        ordersSection.classList.add('hidden');
        reportsSection.classList.add('hidden');
        section.classList.remove('hidden');
    }

    // Mobile Sidebar Toggle
    document.getElementById('sidebarToggle').addEventListener('click', toggleMobileSidebar);
    document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileSidebar);

    function toggleMobileSidebar() {
        const mobileSidebar = document.getElementById('mobileSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        if (mobileSidebar.classList.contains('-translate-x-full')) {
            mobileSidebar.classList.remove('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
        } else {
            mobileSidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.remove('hidden');
        }
    }

    // Modal Controls
    const addProductModal = document.getElementById('addProductModal');
    const editProductModal = document.getElementById('editProductModal');
    const viewOrderModal = document.getElementById('viewOrderModal');
    const deleteConfirmModal = document.getElementById('deleteConfirmModal');

    document.getElementById('addProductBtn').addEventListener('click', function() {
        addProductModal.classList.remove('hidden');
    });

    document.getElementById('closeAddProductModal').addEventListener('click', function() {
        addProductModal.classList.add('hidden');
    });

    document.getElementById('closeEditProductModal').addEventListener('click', function() {
        editProductModal.classList.add('hidden');
    });

    document.getElementById('closeViewOrderModal').addEventListener('click', function() {
        viewOrderModal.classList.add('hidden');
    });

    document.getElementById('cancelDelete').addEventListener('click', function() {
        deleteConfirmModal.classList.add('hidden');
    });

    // API Functions
    async function fetchProducts() {
        try {
            const response = await fetch(PANTRY_API_URL);

            if (!response.ok) {
                throw new Error(`Failed to fetch products: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            products = data.products || [];
            return products;
        } catch (error) {
            console.error('Error fetching products:', error);
            showToast('Failed to load products', 'error');
            return [];
        }
    }

    async function saveProducts() {
        try {
            const response = await fetch(PANTRY_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ products: products }),
            });

            if (!response.ok) {
                throw new Error(`Failed to save products: ${response.status} ${response.statusText}`);
            }

            return true;
        } catch (error) {
            console.error('Error saving products:', error);
            showToast('Failed to save products', 'error');
            return false;
        }
    }

    async function fetchOrders() {
        try {
            const response = await fetch(ORDERS_API_URL);

            if (!response.ok) {
                // If basket doesn't exist yet, create it
                if (response.status === 404) {
                    await createOrdersBasket();
                    return [];
                }
                throw new Error(`Failed to fetch orders: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            // Ensure each order has a status, defaulting to 'Pending' if missing
            orders = (data.orders || []).map(order => ({
                ...order,
                status: order.status || 'Pending'
            }));
            return orders;
        } catch (error) {
            console.error('Error fetching orders:', error);
            showToast('Failed to load orders', 'error');
            return [];
        }
    }

    async function createOrdersBasket() {
        try {
            const response = await fetch(ORDERS_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ orders: [] }),
            });

            if (!response.ok) {
                throw new Error(`Failed to create orders basket: ${response.status} ${response.statusText}`);
            }

            return true;
        } catch (error) {
            console.error('Error creating orders basket:', error);
            showToast('Failed to initialize orders', 'error');
            return false;
        }
    }

    async function saveOrders() {
        try {
            const response = await fetch(ORDERS_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ orders: orders }),
            });

            if (!response.ok) {
                throw new Error(`Failed to save orders: ${response.status} ${response.statusText}`);
            }

            return true;
        } catch (error) {
            console.error('Error saving orders:', error);
            showToast('Failed to save orders', 'error');
            return false;
        }
    }

    // Dashboard Functions
    function updateDashboardStats() {
        document.getElementById('totalProducts').textContent = products.length;
        document.getElementById('totalOrders').textContent = orders.length;

        // Calculate total revenue from all delivered/shipped orders for the main dashboard stat
        const totalRevenue = orders.reduce((sum, order) => {
            if (order.status === 'Delivered' || order.status === 'Shipped') {
                return sum + order.totals.total;
            }
            return sum;
        }, 0);
        document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;

        updateRecentOrders();
    }

    function updateRecentOrders() {
        const recentOrdersTable = document.getElementById('recentOrdersTable');
        recentOrdersTable.innerHTML = '';

        // Sort by orderDate and take the first 5
        const recentOrders = [...orders].sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate)).slice(0, 5);

        if (recentOrders.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="5">No recent orders</td>
            `;
            recentOrdersTable.appendChild(row);
            return;
        }

        recentOrders.forEach(order => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">#${order.id}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${order.customer.firstName} ${order.customer.lastName}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${new Date(order.orderDate).toLocaleDateString()}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">$${order.totals.total.toFixed(2)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <span class="px-2 py-1 rounded-full text-xs ${getStatusColor(order.status)}">
                        ${order.status}
                    </span>
                </td>
            `;
            recentOrdersTable.appendChild(row);
        });
    }

    function getStatusColor(status) {
        switch (status) {
            case 'Pending':
                return 'bg-yellow-100 text-yellow-800';
            case 'Processing':
                return 'bg-blue-100 text-blue-800';
            case 'Shipped':
                return 'bg-purple-100 text-purple-800';
            case 'Delivered':
                return 'bg-green-100 text-green-800';
            case 'Cancelled':
                return 'bg-red-100 text-red-800';
            default:
                return 'bg-gray-100 text-gray-800';
        }
    }

    // Products Functions
    function displayProducts(productsList = products) {
        const productsTable = document.getElementById('productsTable');
        productsTable.innerHTML = '';

        if (productsList.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="6">No products found</td>
            `;
            productsTable.appendChild(row);
            return;
        }

        productsList.forEach(product => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <img src="${product.image}" alt="${product.name}" class="h-16 w-16 object-cover rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/64x64/E5E7EB/111827?text=No+Image';">
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium">${product.name}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${product.category}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium">$${product.price.toFixed(2)}</div>
                    ${product.originalPrice ? `<div class="text-xs text-gray-500 line-through">$${product.originalPrice.toFixed(2)}</div>` : ''}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 rounded-full text-xs ${product.inStock ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${product.inStock ? 'In Stock' : 'Out of Stock'}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <div class="flex space-x-2">
                        <button class="text-blue-600 hover:text-blue-800 edit-product" data-id="${product.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-800 delete-product" data-id="${product.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            productsTable.appendChild(row);
        });

        // Add event listeners to edit and delete buttons
        document.querySelectorAll('.edit-product').forEach(button => {
            button.addEventListener('click', function() {
                const productId = parseInt(this.getAttribute('data-id'));
                openEditProductModal(productId);
            });
        });

        document.querySelectorAll('.delete-product').forEach(button => {
            button.addEventListener('click', function() {
                const productId = parseInt(this.getAttribute('data-id'));
                openDeleteConfirmModal(productId);
            });
        });
    }

    function filterProducts() {
        const searchTerm = document.getElementById('productSearch').value.toLowerCase();
        const categoryFilter = document.getElementById('categoryFilter').value;

        let filteredProducts = products;

        // Apply category filter
        if (categoryFilter) {
            filteredProducts = filteredProducts.filter(product => product.category === categoryFilter);
        }

        // Apply search filter
        if (searchTerm) {
            filteredProducts = filteredProducts.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                product.description.toLowerCase().includes(searchTerm) ||
                product.category.toLowerCase().includes(searchTerm)
            );
        }

        displayProducts(filteredProducts);
    }

    function openEditProductModal(productId) {
        const product = products.find(p => p.id === productId);

        if (!product) {
            showToast('Product not found', 'error');
            return;
        }

        document.getElementById('editProductId').value = product.id;
        document.getElementById('editProductName').value = product.name;
        document.getElementById('editProductCategory').value = product.category;
        document.getElementById('editProductPrice').value = product.price;
        document.getElementById('editProductOriginalPrice').value = product.originalPrice || '';
        document.getElementById('editProductImage').value = product.image;
        document.getElementById('editProductDescription').value = product.description;
        document.getElementById('editProductRating').value = product.rating;
        document.getElementById('editProductReviews').value = product.reviews;
        document.getElementById('editProductDiscount').value = product.discount || '';
        document.getElementById('editProductInStock').checked = product.inStock;

        editProductModal.classList.remove('hidden');
    }

    function openDeleteConfirmModal(productId) {
        document.getElementById('deleteProductId').value = productId;
        deleteConfirmModal.classList.remove('hidden');
    }

    // Orders Functions
    function displayOrders(ordersList = orders) {
        const ordersTable = document.getElementById('ordersTable');
        ordersTable.innerHTML = '';

        if (ordersList.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="6">No orders found</td>
            `;
            ordersTable.appendChild(row);
            return;
        }

        ordersList.forEach(order => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">#${order.id}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${order.customer.firstName} ${order.customer.lastName}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${new Date(order.orderDate).toLocaleDateString()}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">$${order.totals.total.toFixed(2)}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 rounded-full text-xs ${getStatusColor(order.status)}">
                        ${order.status}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <button class="text-blue-600 hover:text-blue-800 view-order" data-id="${order.id}">
                        <i class="fas fa-eye"></i> View
                    </button>
                </td>
            `;
            ordersTable.appendChild(row);
        });

        // Add event listeners to view buttons
        document.querySelectorAll('.view-order').forEach(button => {
            button.addEventListener('click', function() {
                const orderId = this.getAttribute('data-id'); // Keep as string to match order.id type
                openViewOrderModal(orderId);
            });
        });
    }

    function filterOrders() {
        const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;

        let filteredOrders = orders;

        // Apply status filter
        if (statusFilter) {
            filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
        }

        // Apply search filter
        if (searchTerm) {
            filteredOrders = filteredOrders.filter(order =>
                order.id.toLowerCase().includes(searchTerm) ||
                order.customer.firstName.toLowerCase().includes(searchTerm) ||
                order.customer.lastName.toLowerCase().includes(searchTerm) ||
                order.customer.email.toLowerCase().includes(searchTerm)
            );
        }

        displayOrders(filteredOrders);
    }

    function openViewOrderModal(orderId) {
        const order = orders.find(o => o.id === orderId);

        if (!order) {
            showToast('Order not found', 'error');
            return;
        }

        const orderDetailsContent = document.getElementById('orderDetailsContent');

        // Format the order date using order.orderDate
        const orderDate = new Date(order.orderDate).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });

        // Generate the order items HTML
        let orderItemsHtml = '';
        order.items.forEach(item => {
            orderItemsHtml += `
                <div class="flex gap-4 p-4 border-b last:border-b-0">
                    <img class="w-16 h-16 object-cover rounded-lg" src="${item.image}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/64x64/E5E7EB/111827?text=No+Image';">
                    <div class="flex-grow">
                        <div class="flex justify-between mb-1">
                            <h4 class="font-medium">${item.name}</h4>
                            <span class="font-medium">$${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-500">
                            <span>Qty: ${item.quantity}</span>
                            <span>$${item.price.toFixed(2)} each</span>
                        </div>
                    </div>
                </div>
            `;
        });

        // Generate the full order details HTML
        orderDetailsContent.innerHTML = `
            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-gray-500">Order ID:</span>
                    <span class="font-medium">#${order.id}</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="text-gray-500">Date:</span>
                    <span>${orderDate}</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="text-gray-500">Status:</span>
                    <span class="px-2 py-1 rounded-full text-xs ${getStatusColor(order.status)}">
                        ${order.status}
                    </span>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="font-medium mb-2">Customer Information</h3>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="mb-2">
                        <div class="font-medium">${order.customer.firstName} ${order.customer.lastName}</div>
                        <div class="text-sm text-gray-500">${order.customer.email}</div>
                        <div class="text-sm text-gray-500">${order.customer.phone || 'No phone provided'}</div>
                    </div>
                    <div>
                        <div class="text-sm">${order.shipping.address}</div>
                        <div class="text-sm">${order.shipping.city}, ${order.shipping.state} ${order.shipping.zip}</div>
                        <div class="text-sm">Tanzania</div>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="font-medium mb-2">Order Items</h3>
                <div class="border rounded-lg overflow-hidden">
                    ${orderItemsHtml}
                </div>
            </div>

            <div>
                <h3 class="font-medium mb-2">Order Summary</h3>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-500">Subtotal</span>
                        <span>$${order.totals.subtotal.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-500">Shipping</span>
                        <span>$${order.totals.shipping.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-500">Tax</span>
                        <span>$${order.totals.tax.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between pt-2 border-t font-medium">
                        <span>Total</span>
                        <span>$${order.totals.total.toFixed(2)}</span>
                    </div>
                </div>
            </div>
        `;

        document.getElementById('orderStatus').value = order.status; // Use actual order status
        document.getElementById('updateOrderStatus').setAttribute('data-id', order.id);

        viewOrderModal.classList.remove('hidden');
    }

    // Form Submission Handlers
    document.getElementById('addProductForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const newProduct = {
            id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
            name: document.getElementById('productName').value,
            category: document.getElementById('productCategory').value,
            price: parseFloat(document.getElementById('productPrice').value),
            image: document.getElementById('productImage').value,
            description: document.getElementById('productDescription').value,
            rating: parseFloat(document.getElementById('productRating').value),
            reviews: parseInt(document.getElementById('productReviews').value),
            inStock: document.getElementById('productInStock').checked
        };

        const originalPrice = document.getElementById('productOriginalPrice').value;
        if (originalPrice) {
            newProduct.originalPrice = parseFloat(originalPrice);
        }

        const discount = document.getElementById('productDiscount').value;
        if (discount) {
            newProduct.discount = parseInt(discount);
        }

        products.push(newProduct);

        const success = await saveProducts();

        if (success) {
            addProductModal.classList.add('hidden');
            document.getElementById('addProductForm').reset();
            displayProducts();
            updateDashboardStats();
            showToast('Product added successfully!', 'success');
        } else {
            showToast('Failed to add product. Please try again.', 'error');
        }
    });

    document.getElementById('editProductForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const productId = parseInt(document.getElementById('editProductId').value);
        const productIndex = products.findIndex(p => p.id === productId);

        if (productIndex === -1) {
            showToast('Product not found.', 'error');
            return;
        }

        const updatedProduct = {
            id: productId,
            name: document.getElementById('editProductName').value,
            category: document.getElementById('editProductCategory').value,
            price: parseFloat(document.getElementById('editProductPrice').value),
            image: document.getElementById('editProductImage').value,
            description: document.getElementById('editProductDescription').value,
            rating: parseFloat(document.getElementById('editProductRating').value),
            reviews: parseInt(document.getElementById('editProductReviews').value),
            inStock: document.getElementById('editProductInStock').checked
        };

        const originalPrice = document.getElementById('editProductOriginalPrice').value;
        if (originalPrice) {
            updatedProduct.originalPrice = parseFloat(originalPrice);
        }

        const discount = document.getElementById('editProductDiscount').value;
        if (discount) {
            updatedProduct.discount = parseInt(discount);
        }

        // Save the old product name for the notification
        const oldProductName = products[productIndex].name;

        // Update the product
        products[productIndex] = updatedProduct;

        const success = await saveProducts();

        if (success) {
            editProductModal.classList.add('hidden');
            displayProducts();
            updateDashboardStats();
            showToast(`"${oldProductName}" updated successfully!`, 'success');
        } else {
            showToast('Failed to update product. Please try again.', 'error');
        }
    });

    document.getElementById('confirmDelete').addEventListener('click', async function() {
        const productId = parseInt(document.getElementById('deleteProductId').value);
        const productIndex = products.findIndex(p => p.id === productId);

        if (productIndex === -1) {
            showToast('Product not found.', 'error');
            deleteConfirmModal.classList.add('hidden');
            return;
        }

        // Save the product name for the notification
        const productName = products[productIndex].name;

        // Remove the product
        products.splice(productIndex, 1);

        const success = await saveProducts();

        if (success) {
            deleteConfirmModal.classList.add('hidden');
            displayProducts();
            updateDashboardStats();
            showToast(`"${productName}" deleted successfully!`, 'warning');
        } else {
            showToast('Failed to delete product. Please try again.', 'error');
        }
    });

    document.getElementById('updateOrderStatus').addEventListener('click', async function() {
        const orderId = this.getAttribute('data-id'); // Keep as string
        const orderIndex = orders.findIndex(o => o.id === orderId);

        if (orderIndex === -1) {
            showToast('Order not found.', 'error');
            return;
        }

        const oldStatus = orders[orderIndex].status;
        const newStatus = document.getElementById('orderStatus').value;

        // Skip if status hasn't changed
        if (oldStatus === newStatus) {
            showToast('Status remains unchanged.', 'info');
            return;
        }

        orders[orderIndex].status = newStatus;

        const success = await saveOrders();

        if (success) {
            viewOrderModal.classList.add('hidden');
            displayOrders();
            updateDashboardStats();
            generateReports(); // Regenerate reports when status changes
            showToast(`Order #${orderId} status updated to "${newStatus}"`, 'success');
        } else {
            showToast('Failed to update order status. Please try again.', 'error');
        }
    });

    // Search and Filter Event Listeners
    document.getElementById('productSearch').addEventListener('input', filterProducts);
    document.getElementById('categoryFilter').addEventListener('change', filterProducts);
    document.getElementById('orderSearch').addEventListener('input', filterOrders);
    document.getElementById('statusFilter').addEventListener('change', filterOrders);

    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === addProductModal) {
            addProductModal.classList.add('hidden');
        } else if (event.target === editProductModal) {
            editProductModal.classList.add('hidden');
        } else if (event.target === viewOrderModal) {
            viewOrderModal.classList.add('hidden');
        } else if (event.target === deleteConfirmModal) {
            deleteConfirmModal.classList.add('hidden');
        }
    });

    // --- Reports Functions ---
    const dailyReportContent = document.getElementById('dailyReportContent');
    const weeklyReportContent = document.getElementById('weeklyReportContent');
    const monthlyReportContent = document.getElementById('monthlyReportContent');
    const tabButtons = document.querySelectorAll('.tab-button');

    // Add event listeners to tab buttons
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const tab = this.getAttribute('data-tab');
            activateTab(tab);
        });
    });

    function activateTab(tab) {
        // Remove 'active' class from all buttons and add 'hidden' to all content
        tabButtons.forEach(button => button.classList.remove('active'));
        dailyReportContent.classList.add('hidden');
        weeklyReportContent.classList.add('hidden');
        monthlyReportContent.classList.add('hidden');

        // Add 'active' class to the clicked button and show the corresponding content
        document.querySelector(`.tab-button[data-tab="${tab}"]`).classList.add('active');
        document.getElementById(`${tab}ReportContent`).classList.remove('hidden');
    }


    function generateReports() {
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Start of today

        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - today.getDay()); // Start of the current week (Sunday)
        startOfWeek.setHours(0, 0, 0, 0);

        const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1); // Start of the current month
        startOfMonth.setHours(0, 0, 0, 0);

        // Filter orders for each period
        const dailyOrders = orders.filter(order => new Date(order.orderDate) >= today);
        const weeklyOrders = orders.filter(order => new Date(order.orderDate) >= startOfWeek);
        const monthlyOrders = orders.filter(order => new Date(order.orderDate) >= startOfMonth);

        // Calculate totals and status counts for each period
        const dailyReport = calculateReportData(dailyOrders);
        const weeklyReport = calculateReportData(weeklyOrders);
        const monthlyReport = calculateReportData(monthlyOrders);

        // Update the HTML elements
        document.getElementById('dailySalesTotal').textContent = `$${dailyReport.totalSales.toFixed(2)}`;
        document.getElementById('dailyPendingOrders').textContent = dailyReport.statusCounts['Pending'] || 0;
        document.getElementById('dailyProcessingOrders').textContent = dailyReport.statusCounts['Processing'] || 0;
        document.getElementById('dailyShippedOrders').textContent = dailyReport.statusCounts['Shipped'] || 0;
        document.getElementById('dailyDeliveredOrders').textContent = dailyReport.statusCounts['Delivered'] || 0;
        document.getElementById('dailyCancelledOrders').textContent = dailyReport.statusCounts['Cancelled'] || 0;

        document.getElementById('weeklySalesTotal').textContent = `$${weeklyReport.totalSales.toFixed(2)}`;
        document.getElementById('weeklyPendingOrders').textContent = weeklyReport.statusCounts['Pending'] || 0;
        document.getElementById('weeklyProcessingOrders').textContent = weeklyReport.statusCounts['Processing'] || 0;
        document.getElementById('weeklyShippedOrders').textContent = weeklyReport.statusCounts['Shipped'] || 0;
        document.getElementById('weeklyDeliveredOrders').textContent = weeklyReport.statusCounts['Delivered'] || 0;
        document.getElementById('weeklyCancelledOrders').textContent = weeklyReport.statusCounts['Cancelled'] || 0;

        document.getElementById('monthlySalesTotal').textContent = `$${monthlyReport.totalSales.toFixed(2)}`;
        document.getElementById('monthlyPendingOrders').textContent = monthlyReport.statusCounts['Pending'] || 0;
        document.getElementById('monthlyProcessingOrders').textContent = monthlyReport.statusCounts['Processing'] || 0;
        document.getElementById('monthlyShippedOrders').textContent = monthlyReport.statusCounts['Shipped'] || 0;
        document.getElementById('monthlyDeliveredOrders').textContent = monthlyReport.statusCounts['Delivered'] || 0;
        document.getElementById('monthlyCancelledOrders').textContent = monthlyReport.statusCounts['Cancelled'] || 0;
    }

    // Helper function to calculate total sales (only Delivered or Shipped) and status counts
    function calculateReportData(ordersList) {
        let totalSales = 0;
        const statusCounts = {
            'Pending': 0,
            'Processing': 0,
            'Shipped': 0,
            'Delivered': 0,
            'Cancelled': 0
        };

        ordersList.forEach(order => {
            // Only include 'Delivered' or 'Shipped' orders for total sales
            if (order.status === 'Delivered' || order.status === 'Shipped') {
                 totalSales += order.totals.total;
            }

            if (statusCounts[order.status] !== undefined) {
                statusCounts[order.status]++;
            }
        });

        return { totalSales, statusCounts };
    }


    async function initializeDashboard() {
        showLoading(); // Show loading spinner before fetching
        try {
            await fetchProducts();
            await fetchOrders(); // This now fetches from the API

            displayProducts();
            displayOrders();
            updateDashboardStats();
            generateReports(); // Generate reports on initial load
            activateTab('daily'); // Activate the daily tab on initial load

            showToast('Dashboard loaded successfully!', 'success');
        } catch (error) {
            console.error('Error initializing dashboard:', error);
            showToast('Error loading dashboard. Please refresh the page.', 'error');
        } finally {
            hideLoading(); // Hide loading spinner after fetching (success or error)
        }
    }

    // Call initialization function
    initializeDashboard();
});
    </script>
</body>
</html>
